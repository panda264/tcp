<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1" ProductVersion="3.1.4024.11">
  <POU Name="FB_ClientApplication" Id="{e6f93743-4cda-4449-b45a-5afa668d31ca}" SpecialFunc="None">
    <Declaration><![CDATA[(*------------- Simple TCP/IP application. Adapt this code to match your needs. -----*)
FUNCTION_BLOCK FB_ClientApplication
VAR_IN_OUT
	fbTx 		: FB_FrameFifo;(* TX fifo *)
	fbRx 		: FB_FrameFifo;(* RX fifo *)
	fbLog		: FB_LogFifo;(* Log message fifo *)
END_VAR
VAR_INPUT
	IDriver		: I_TCPDriver;
END_VAR
VAR
	sLogMessage : T_MaxString := '';
	nCounter	: UDINT;
	fbSndTimer	: TON;
	
	trigSend: BOOL;
END_VAR]]></Declaration>
    <Implementation>
      <ST><![CDATA[//Driver Execute cycle
Idriver.M_Cyclic();
(*------------------------------- Send cyclic message strings ------------------------------------------*)
IF Idriver.sWrite <> '' THEN
	trigSend:=TRUE;
ELSE
	trigSend:=FALSE;
END_IF
IF trigSend THEN
	(* Create new message string *)
//	sToServer := ;
	fbTx.AddTail( sPut := IDriver.sWrite);(* Put string to the tx fifo *)
	IF NOT fbTx.bOk THEN(* TX fifo overflow => log error *)
		fbLog.Error( sMessage := 'FB_FrameFifo(sender)', nErrID := PLCPRJ_ERROR_SENDFIFO_OVERFLOW );
	ELSE
		Idriver.sWrite:='';
	END_IF

END_IF

(*------------------------------- Get received message strings ------------------------------------------*)
REPEAT
	fbRx.RemoveHead();(* Fetch string from rx fifo *)
	IF fbRx.bOk THEN(* Success *)

		(* TODO: Implement receive data handler *)
		//sFromServer 
		 IDriver.sRead:= fbRx.sGet;
		
	END_IF
UNTIL NOT fbRx.bOk
END_REPEAT
(*------------------------------- Get log/error messages from log fifo ------------------------------------------*)
REPEAT
	fbLog.Remove( );
	IF fbLog.bOk THEN

		(* TODO: Implement log message handler *)
		sLogMessage := fbLog.sGet;

	END_IF
UNTIL NOT fbLog.bOk
END_REPEAT
]]></ST>
    </Implementation>
    <LineIds Name="FB_ClientApplication">
      <LineId Id="77" Count="0" />
      <LineId Id="76" Count="0" />
      <LineId Id="3" Count="0" />
      <LineId Id="79" Count="3" />
      <LineId Id="78" Count="0" />
      <LineId Id="5" Count="0" />
      <LineId Id="8" Count="0" />
      <LineId Id="10" Count="0" />
      <LineId Id="12" Count="2" />
      <LineId Id="84" Count="1" />
      <LineId Id="15" Count="10" />
      <LineId Id="59" Count="0" />
      <LineId Id="26" Count="3" />
      <LineId Id="32" Count="10" />
      <LineId Id="2" Count="0" />
    </LineIds>
  </POU>
</TcPlcObject>
