<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1" ProductVersion="3.1.4024.11">
  <POU Name="FB_Client" Id="{da1d8024-4715-4044-b9bb-bca3c72615ed}" SpecialFunc="None">
    <Declaration><![CDATA[FUNCTION_BLOCK FB_Client
VAR_INPUT
	sSrvNetID	: T_AmsNetID	:= '';(* TwinCAT TCP/IP server network address *)
	sRemoteHost	: T_IPv4Addr 	:= '127.0.0.1';(* Server network address *)
	nRemotePort	: UDINT 		:= 200;(* Server port number *)
	bEnable		: BOOL 			:= FALSE;(* TRUE => enable client data exchange, FALSE => disable *)
	bLog		: BOOL 			:= FALSE;(* TRUE => Enable log message output, FALSE => Disable *)
	sPrefix		: STRING 		:= 'CLIENT::';(* Log message description string (allows the identification of log message source) *)
END_VAR
VAR_OUTPUT
	eState		: E_SocketConnectionState := eSOCKET_DISCONNECTED;(* TCP/IP connection state *)
END_VAR
VAR
	fbApplication 	: FB_ClientApplication;(* Client application control function block *)
	fbConnection	: FB_ClientConnection;(* Client data exchange control function block *)
	fbTx 			: FB_FrameFifo;(* Tx fifo *)
	fbRx 			: FB_FrameFifo;(* Rx fifo *)
	fbLog			: FB_LogFifo;(* Log/debug/error fifo *)
	iDriver			: I_TCPDriver;
END_VAR
]]></Declaration>
    <Implementation>
      <ST><![CDATA[(*-------------------------- Trigger data exchange -----------------------------------------------*)
fbConnection( 	sSrvNetID := sSrvNetID, fbRx := fbRx, fbTx := fbTx, fbLog := fbLog, 
				bEnable := bEnable, sRemoteHost := sRemoteHost, nRemotePort := nRemotePort, 
				Idriver:=iDriver, 
				bLog := bLog, sPrefix := sPrefix, eState=>eState );
	
IF fbConnection.eState = eSOCKET_CONNECTED THEN(* Connection established *)
	fbApplication( fbTx := fbTx, fbRx := fbRx, fbLog := fbLog,IDriver:=iDriver );
END_IF
]]></ST>
    </Implementation>
    <Method Name="FB_init" Id="{3fe312de-71bd-4eb1-ab92-89403f5a565f}">
      <Declaration><![CDATA[METHOD FB_init : BOOL
VAR_INPUT
	bInitRetains 	: BOOL; // if TRUE, the retain variables are initialized (warm start / cold start)
	bInCopyCode		: BOOL;  // if TRUE, the instance afterwards gets moved into the copy code (online change)
	Driver			:I_TCPDriver;
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[iDriver:=Driver;]]></ST>
      </Implementation>
    </Method>
    <LineIds Name="FB_Client">
      <LineId Id="3" Count="2" />
      <LineId Id="31" Count="0" />
      <LineId Id="6" Count="4" />
      <LineId Id="2" Count="0" />
    </LineIds>
    <LineIds Name="FB_Client.FB_init">
      <LineId Id="7" Count="0" />
    </LineIds>
  </POU>
</TcPlcObject>
